\doxysection{Orderbook.\+hpp}
\hypertarget{_orderbook_8hpp_source}{}\label{_orderbook_8hpp_source}\index{OrderbookSim/Orderbook.hpp@{OrderbookSim/Orderbook.hpp}}
\mbox{\hyperlink{_orderbook_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_order_8hpp}{Order.hpp}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_trade_8hpp}{Trade.hpp}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_usings_8hpp}{Usings.hpp}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_order_modify_8hpp}{OrderModify.hpp}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_orderbook_level_infos_8hpp}{OrderbookLevelInfos.hpp}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_order_detail_history_8hpp}{OrderDetailHistory.hpp}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <optional>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_orderbook}{Orderbook}}\ \{}
\DoxyCodeLine{00037\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{struct\ }OrderEntry\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_order_8hpp_abd4d2b4dd984ef7a42731f33c665be3e}{OrderPtr}}\ \_order\{\ \textcolor{keyword}{nullptr}\ \};\ }
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ OrderPtrs::iterator\ \_location;\ }
\DoxyCodeLine{00045\ \ \ \ \ \};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{enum\ class}\ ExecutionTypes\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ BuyersPrice,\ \ \ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ SellersPrice,\ \ }
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ MidPrice\ \ \ \ \ \ \ }
\DoxyCodeLine{00055\ \ \ \ \ \};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keyword}{struct\ }LevelData\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_usings_8hpp_a90c79bb14ac40b274a4d20dd85f0469d}{Quantity}}\ \_quantity\{\};\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_usings_8hpp_a90c79bb14ac40b274a4d20dd85f0469d}{Quantity}}\ \_count\{\};\ \ \ \ }
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keyword}{enum\ class}\ Action\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test_8cpp_a21d5e8f8cdaa838586b31007df0a950baec211f7c20af43e742bf2570c3cb84f9}{Add}},\ \ \ \ }
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ Remove,\ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ Match\ \ \ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00074\ \ \ \ \ \};}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ std::map<Price,\ OrderPtrs,\ std::greater<Price>>\ \_asks;\ }
\DoxyCodeLine{00077\ \ \ \ \ std::map<Price,\ OrderPtrs,\ std::less<Price>>\ \_bids;\ }
\DoxyCodeLine{00078\ \ \ \ \ std::unordered\_map<OrderId,\ OrderEntry>\ \_orders;\ }
\DoxyCodeLine{00079\ \ \ \ \ std::unordered\_map<Price,\ LevelData>\ \_data;\ }
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{mutable}\ std::mutex\ \_ordersMutex;\ }
\DoxyCodeLine{00082\ \ \ \ \ std::thread\ \_ordersPruneThread;\ }
\DoxyCodeLine{00083\ \ \ \ \ std::condition\_variable\ \_shutdownConditionVariable;\ }
\DoxyCodeLine{00084\ \ \ \ \ std::atomic<bool>\ \_shutdown\{\ \textcolor{keyword}{false}\ \};\ }
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ ExecutionTypes\ \_executionType\ =\ ExecutionTypes::BuyersPrice;\ }
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{class_order_detail_history}{OrderDetailHistory}}\ \_orderDetailHistory;\ }
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ Private\ member\ functions}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{bool}\ canMatch(\mbox{\hyperlink{_side_8hpp_a8c0137d7160ad71b6ed265c53c99ed00}{Side}}\ side,\ \mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ price)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{_trade_8hpp_a2ac952e5c0e734c3b7ab2068eb3d6527}{Trades}}\ MatchOrders();}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordtype}{void}\ CancelOrders(\mbox{\hyperlink{_usings_8hpp_a486ef20e0a73d508bd0cce5f8217810b}{OrderIds}}\ orderIds);}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ CancelOrderInternal(\mbox{\hyperlink{_usings_8hpp_a90716e500cb73455f03ac5b21fc7c219}{OrderId}}\ orderId);}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordtype}{bool}\ canFullyFill(\mbox{\hyperlink{_side_8hpp_a8c0137d7160ad71b6ed265c53c99ed00}{Side}}\ side,\ \mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ price,\ \mbox{\hyperlink{_usings_8hpp_a90c79bb14ac40b274a4d20dd85f0469d}{Quantity}}\ quantity)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordtype}{void}\ onOrderCanceleld(\mbox{\hyperlink{_order_8hpp_abd4d2b4dd984ef7a42731f33c665be3e}{OrderPtr}}\ order);}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordtype}{void}\ onOrderAdded(\mbox{\hyperlink{_order_8hpp_abd4d2b4dd984ef7a42731f33c665be3e}{OrderPtr}}\ order);}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordtype}{void}\ onOrderMatchedWithHistoryUpdate(\mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ price,\ \mbox{\hyperlink{_usings_8hpp_a90c79bb14ac40b274a4d20dd85f0469d}{Quantity}}\ quantity,\ \textcolor{keywordtype}{bool}\ isFullyFilled,\ \mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ purchasePrice);}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordtype}{void}\ onOrderMatched(\mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ price,\ \mbox{\hyperlink{_usings_8hpp_a90c79bb14ac40b274a4d20dd85f0469d}{Quantity}}\ quantity,\ \textcolor{keywordtype}{bool}\ isFullyFilled);}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordtype}{void}\ UpdateLevelData(\mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ price,\ \mbox{\hyperlink{_usings_8hpp_a90c79bb14ac40b274a4d20dd85f0469d}{Quantity}}\ quantity,\ LevelData::Action\ action);}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{_trade_8hpp_a2ac952e5c0e734c3b7ab2068eb3d6527}{Trades}}\ MatchOrder(\mbox{\hyperlink{class_order_modify}{OrderModify}}\ order);}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ Private\ methods\ for\ managing\ Good\ For\ Day\ orders}}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordtype}{void}\ PruneGoodForDayOrders();}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00110\ \ \ \ \ \mbox{\hyperlink{class_orderbook_a521fdf132ea09cc850841a297c430cf8}{Orderbook}}()\ :\ \_ordersPruneThread\{\ [this]\ \{\ PruneGoodForDayOrders();\ \}\ \}\ \{\}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ Deleted\ copy\ and\ move\ constructors\ and\ operators\ to\ prevent\ copying}}
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{class_orderbook_ae5d180f91097539104f0f03349403b39}{Orderbook}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_orderbook}{Orderbook}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_orderbook_a573bcef2f870628ac57a3a24fb58a9df}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_orderbook}{Orderbook}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00115\ \ \ \ \ \mbox{\hyperlink{class_orderbook_a889f02b725a5bce9c683c19543adfdec}{Orderbook}}(\mbox{\hyperlink{class_orderbook}{Orderbook}}\&\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_orderbook_aab0e3ce19014d476754c7f6d0c38d0b4}{operator=}}(\mbox{\hyperlink{class_orderbook}{Orderbook}}\&\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00121\ \ \ \ \ \mbox{\hyperlink{class_orderbook_aca29249ec0f8e13a892b5f5d822e48ac}{\string~Orderbook}}()\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \_shutdown.store(\textcolor{keyword}{true},\ std::memory\_order\_release);}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \_shutdownConditionVariable.notify\_one();}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \_ordersPruneThread.join();}
\DoxyCodeLine{00125\ \ \ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordtype}{void}\ changeExecutionType(\textcolor{keywordtype}{int}\ type);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00140\ \ \ \ \ \mbox{\hyperlink{_trade_8hpp_a2ac952e5c0e734c3b7ab2068eb3d6527}{Trades}}\ \mbox{\hyperlink{namespaceadd_order}{addOrder}}(\mbox{\hyperlink{_order_8hpp_abd4d2b4dd984ef7a42731f33c665be3e}{OrderPtr}}\ order);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{_trade_8hpp_a2ac952e5c0e734c3b7ab2068eb3d6527}{Trades}}\ \mbox{\hyperlink{namespaceadd_order}{addOrder}}(\mbox{\hyperlink{_order_type_8hpp_a57124e387290311f33f3b54a54930418}{OrderType}}\ type,\ \mbox{\hyperlink{_side_8hpp_a8c0137d7160ad71b6ed265c53c99ed00}{Side}}\ side,\ \mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ price,\ \mbox{\hyperlink{_usings_8hpp_a90c79bb14ac40b274a4d20dd85f0469d}{Quantity}}\ qty);}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00163\ \ \ \ \ \mbox{\hyperlink{_trade_8hpp_a2ac952e5c0e734c3b7ab2068eb3d6527}{Trades}}\ \mbox{\hyperlink{namespaceadd_order}{addOrder}}(\mbox{\hyperlink{_order_type_8hpp_a57124e387290311f33f3b54a54930418}{OrderType}}\ type,\ \mbox{\hyperlink{_usings_8hpp_a90716e500cb73455f03ac5b21fc7c219}{OrderId}}\ orderId,\ \mbox{\hyperlink{_side_8hpp_a8c0137d7160ad71b6ed265c53c99ed00}{Side}}\ side,\ \mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ price,\ \mbox{\hyperlink{_usings_8hpp_a90c79bb14ac40b274a4d20dd85f0469d}{Quantity}}\ qty);}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordtype}{void}\ addOrderViaPython(\textcolor{keywordtype}{int}\ type,\ \textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id},\ \textcolor{keywordtype}{int}\ side,\ \textcolor{keywordtype}{int}\ price,\ \textcolor{keywordtype}{int}\ qty);}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{void}\ CancelOrder(\mbox{\hyperlink{_usings_8hpp_a90716e500cb73455f03ac5b21fc7c219}{OrderId}}\ orderId);}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00189\ \ \ \ \ \mbox{\hyperlink{_trade_8hpp_a2ac952e5c0e734c3b7ab2068eb3d6527}{Trades}}\ ModifyOrder(\mbox{\hyperlink{class_order_modify}{OrderModify}}\ order);}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordtype}{void}\ setPriceScale(\mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ \_price);}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00203\ \ \ \ \ \mbox{\hyperlink{_usings_8hpp_a375e30b119b87df2956b839a36a8d2d5}{Price}}\ getPriceScale();}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordtype}{void}\ printAllOrders();}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordtype}{void}\ saveToJson(\textcolor{keyword}{const}\ std::string\&\ buyfilename\ =\ \textcolor{stringliteral}{"{}BuyHistory.json"{}},\ \textcolor{keyword}{const}\ std::string\&\ sellfilename\ =\ \textcolor{stringliteral}{"{}SellHistory.json"{}},\ \textcolor{keyword}{const}\ std::string\&\ purchasefilename\ =\ \textcolor{stringliteral}{"{}PurchaseHistory.json"{}},\ \textcolor{keyword}{const}\ std::string\&\ buyLivefilename\ =\ \textcolor{stringliteral}{"{}BuyLiveHistory.json"{}},\ \textcolor{keyword}{const}\ std::string\&\ sellLivefilename\ =\ \textcolor{stringliteral}{"{}SellLiveHistory.json"{}});}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00228\ \ \ \ \ std::size\_t\ Size()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{class_orderbook_level_infos}{OrderbookLevelInfos}}\ getOrderInfos()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordtype}{void}\ EndOfDay();}
\DoxyCodeLine{00246\ \};}

\end{DoxyCode}
